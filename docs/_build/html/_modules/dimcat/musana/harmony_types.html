
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>dimcat.musana.harmony_types &#8212; dimcat 0.3.0.post1.dev48+gb31e433.d20230210 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />


  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">


          <div class="body" role="main">

  <h1>Source code for dimcat.musana.harmony_types</h1><div class="highlight"><pre>
<span></span><span class="c1"># Defining the harmony concepts.</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cache</span>

<span class="kn">import</span> <span class="nn">regex_spm</span>
<span class="kn">from</span> <span class="nn">pitchtypes</span> <span class="kn">import</span> <span class="n">SpelledIntervalClass</span> <span class="k">as</span> <span class="n">SpelledIntervalClass</span>
<span class="kn">from</span> <span class="nn">pitchtypes</span> <span class="kn">import</span> <span class="n">SpelledPitchClass</span> <span class="k">as</span> <span class="n">_SpelledPitchClass</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="SpelledPitchClass"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SpelledPitchClass">[docs]</a><span class="k">class</span> <span class="nc">SpelledPitchClass</span><span class="p">(</span><span class="n">_SpelledPitchClass</span><span class="p">):</span>
<div class="viewcode-block" id="SpelledPitchClass.alteration_ic"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SpelledPitchClass.alteration_ic">[docs]</a>    <span class="k">def</span> <span class="nf">alteration_ic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpelledIntervalClass</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alteration</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">alteration_symbol</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">alteration</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">alteration</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">alteration_symbol</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span>  <span class="c1"># perfect unison, no alterations</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">alteration</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">alteration_symbol</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alteration</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alteration</span><span class="p">)</span>
        <span class="n">interval_class</span> <span class="o">=</span> <span class="n">SpelledIntervalClass</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">alteration_symbol</span><span class="si">}</span><span class="s2">1&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">interval_class</span></div></div>


<div class="viewcode-block" id="HarmonyRegexes"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.HarmonyRegexes">[docs]</a><span class="k">class</span> <span class="nc">HarmonyRegexes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a class to hold all the regular expressions in the harmony string input&quot;&quot;&quot;</span>

    <span class="n">key_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s2">&quot;^(?P&lt;class&gt;[A-G])(?P&lt;modifiers&gt;(b*)|(#*))$&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span>
    <span class="p">)</span>  <span class="c1"># case-insensitive</span>

    <span class="n">arabic_degree_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(?P&lt;modifiers&gt;[#b]*)(?P&lt;number&gt;(\d+))$&quot;</span><span class="p">)</span>
    <span class="n">roman_degree_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s2">&quot;^(?P&lt;modifiers&gt;[#b]*)(?P&lt;roman_numeral&gt;([VI]+))$&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span>
    <span class="p">)</span>

    <span class="n">figuredbass_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(?P&lt;figbass&gt;(7|65|43|42|2|64|6))&quot;</span><span class="p">)</span>

    <span class="n">added_tone_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;(\+[#b]*\d*)&quot;</span>
    <span class="p">)</span>  <span class="c1"># TODO: ?? Added tones are always preceded by &#39;+&#39;?? double check the standards?</span>

    <span class="n">replacement_tone_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([\^v][#b]*\d*)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProtocolHarmony"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.ProtocolHarmony">[docs]</a><span class="k">class</span> <span class="nc">ProtocolHarmony</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">Protocol</span><span class="p">):</span>
<div class="viewcode-block" id="ProtocolHarmony.root"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.ProtocolHarmony.root">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpelledPitchClass</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ProtocolHarmony.key_if_tonicized"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.ProtocolHarmony.key_if_tonicized">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">key_if_tonicized</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Key</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ProtocolHarmony.pc_set"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.ProtocolHarmony.pc_set">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">pc_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">SpelledPitchClass</span><span class="p">]:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ProtocolHarmony.chord_tones"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.ProtocolHarmony.chord_tones">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">chord_tones</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">SpelledPitchClass</span><span class="p">]:</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Key"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.Key">[docs]</a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Key</span><span class="p">:</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">SpelledPitchClass</span>
    <span class="n">mode</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">]</span>

    <span class="n">_M_intervals</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span> <span class="s2">&quot;M2&quot;</span><span class="p">,</span> <span class="s2">&quot;M3&quot;</span><span class="p">,</span> <span class="s2">&quot;P4&quot;</span><span class="p">,</span> <span class="s2">&quot;P5&quot;</span><span class="p">,</span> <span class="s2">&quot;M6&quot;</span><span class="p">,</span> <span class="s2">&quot;M7&quot;</span><span class="p">]</span>
    <span class="n">_m_intervals</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span> <span class="s2">&quot;M2&quot;</span><span class="p">,</span> <span class="s2">&quot;m3&quot;</span><span class="p">,</span> <span class="s2">&quot;P4&quot;</span><span class="p">,</span> <span class="s2">&quot;P5&quot;</span><span class="p">,</span> <span class="s2">&quot;m6&quot;</span><span class="p">,</span> <span class="s2">&quot;m7&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="Key.parse"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.Key.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Key</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;expected string as input, got </span><span class="si">{</span><span class="n">key_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">key_match</span> <span class="o">=</span> <span class="n">HarmonyRegexes</span><span class="o">.</span><span class="n">key_regex</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">key_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;could not match &#39;</span><span class="si">{</span><span class="n">key_str</span><span class="si">}</span><span class="s2">&#39; with regex: &#39;</span><span class="si">{</span><span class="n">HarmonyRegexes</span><span class="o">.</span><span class="n">key_regex</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;M&quot;</span> <span class="k">if</span> <span class="n">key_match</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;m&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">SpelledPitchClass</span><span class="p">(</span><span class="n">key_match</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">key_match</span><span class="p">[</span><span class="s2">&quot;modifiers&quot;</span><span class="p">])</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div>

<div class="viewcode-block" id="Key.find_pc"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.Key.find_pc">[docs]</a>    <span class="k">def</span> <span class="nf">find_pc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">:</span> <span class="n">Degree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpelledPitchClass</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
            <span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_M_intervals</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m_intervals</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[</span><span class="n">degree</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="n">SpelledIntervalClass</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">SpelledPitchClass</span><span class="p">(</span>
            <span class="n">pc</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># TODO: do it in the right way later (look up customized SpelledPitchClass)</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">pc</span> <span class="o">-</span> <span class="n">pc</span><span class="o">.</span><span class="n">alteration_ic</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pc</span></div>

    <span class="nd">@property</span>
    <span class="nd">@cache</span>
    <span class="k">def</span> <span class="nf">pcs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">SpelledPitchClass</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_pc</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">Degree</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">alteration</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">]</span>

<div class="viewcode-block" id="Key.to_str"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.Key.to_str">[docs]</a>    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">resulting_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
            <span class="n">resulting_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;not applicable mode&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resulting_str</span></div></div>


<div class="viewcode-block" id="Degree"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.Degree">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Degree</span><span class="p">:</span>
    <span class="n">number</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">alteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">bool</span>  <span class="c1"># when int: positive for &quot;#&quot;, negative for &quot;b&quot;, when bool: represent whether to use natural</span>

    <span class="n">_numeral_scale_degree_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;ii&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;iii&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;iv&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;vi&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;vii&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s2">&quot;I&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;II&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;III&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;IV&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;VI&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;VII&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        n steps (0 steps is unison) &lt;-- degree (1 is unison)</span>
<span class="sd">        |</span>
<span class="sd">        V</span>
<span class="sd">        n steps (0 steps is unison) --&gt; degree (1 is unison)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">number</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">alteration</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">alteration</span>
        <span class="k">return</span> <span class="n">Degree</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">alteration</span><span class="o">=</span><span class="n">alteration</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
        <span class="n">number</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">alteration</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">alteration</span>
        <span class="k">return</span> <span class="n">Degree</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">alteration</span><span class="o">=</span><span class="n">alteration</span><span class="p">)</span>

<div class="viewcode-block" id="Degree.parse"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.Degree.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">degree_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples of arabic_degree: b7, #2, 3, 5, #5, ...</span>
<span class="sd">        Examples of scale degree: bV, bIII, #II, IV, vi, vii</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">regex_spm</span><span class="o">.</span><span class="n">fullmatch_in</span><span class="p">(</span><span class="n">degree_str</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">HarmonyRegexes</span><span class="o">.</span><span class="n">roman_degree_regex</span><span class="p">:</span>
                <span class="n">degree_number</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_numeral_scale_degree_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;roman_numeral&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">HarmonyRegexes</span><span class="o">.</span><span class="n">arabic_degree_regex</span><span class="p">:</span>
                <span class="n">degree_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">])</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;could not match </span><span class="si">{</span><span class="n">match</span><span class="si">}</span><span class="s2"> with regex: </span><span class="si">{</span><span class="n">HarmonyRegexes</span><span class="o">.</span><span class="n">roman_degree_regex</span><span class="si">}</span><span class="s2"> or &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">HarmonyRegexes</span><span class="o">.</span><span class="n">arabic_degree_regex</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="n">modifiers_match</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;modifiers&quot;</span><span class="p">]</span>
        <span class="n">alteration</span> <span class="o">=</span> <span class="n">SpelledPitchClass</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">modifiers_match</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alteration</span><span class="p">()</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">degree_number</span><span class="p">,</span> <span class="n">alteration</span><span class="o">=</span><span class="n">alteration</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div></div>


<div class="viewcode-block" id="IntervalQuality"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.IntervalQuality">[docs]</a><span class="k">class</span> <span class="nc">IntervalQuality</span><span class="p">:</span>
<div class="viewcode-block" id="IntervalQuality.from_interval_class"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.IntervalQuality.from_interval_class">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">from_interval_class</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">spelled_interval_class</span><span class="p">:</span> <span class="n">SpelledIntervalClass</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="P"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.P">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">P</span><span class="p">(</span><span class="n">IntervalQuality</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a type class for perfect intervals</span>
<span class="sd">    alt_steps = 0 means e.g. perfect unison, perfect fifths</span>
<span class="sd">    alt_steps = 1 means aug 1 (A1), aug 5(A5), aug 4...</span>
<span class="sd">    alt_steps = -1 means dim 1 (D1) ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">alt_steps</span><span class="p">:</span> <span class="nb">int</span>

<div class="viewcode-block" id="P.from_interval_class"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.P.from_interval_class">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_interval_class</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">spelled_interval_class</span><span class="p">:</span> <span class="n">SpelledIntervalClass</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>  <span class="c1"># TODO: fill in</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="IP"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.IP">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IP</span><span class="p">(</span><span class="n">IntervalQuality</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a type class for Imperfect intervals</span>
<span class="sd">    alt_steps = 1 means M2, M3, M6 ...</span>
<span class="sd">    alt_steps = 2 means A2, A3, A6 ...</span>
<span class="sd">    alt_steps = 3 means AA2, AA3, ...</span>
<span class="sd">    alt_steps = -1 means m2, m3, m6 ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">alt_steps</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alt_steps</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_steps</span>

<div class="viewcode-block" id="IP.from_interval_class"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.IP.from_interval_class">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_interval_class</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">spelled_interval_class</span><span class="p">:</span> <span class="n">SpelledIntervalClass</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>  <span class="c1"># TODO: fill in</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="HarmonyQuality"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.HarmonyQuality">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">HarmonyQuality</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Examples:</span>
<span class="sd">    stack_of_thirds_3_Mm = HarmonyQuality(stacksize=3,ic_quality_list=[IP(1),IP(-1)]) # Major triad</span>
<span class="sd">    stack_of_thirds_4_mmm = HarmonyQuality(stacksize=3,ic_quality_list=[IP(-1),IP(-1),IP(-1)]) # fully diminished 7th</span>
<span class="sd">    stack_of_fifth_4_PPP = HarmonyQuality(stacksize=5,ic_quality_list=[P(0),P(0),P(0)])</span>
<span class="sd">    stack_of_fifth_3_ADP = HarmonyQuality(stacksize=5,ic_quality_list=[P(-1),P(1),P(0)])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stack_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">interval_class_quality_list</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">P</span> <span class="o">|</span> <span class="n">IP</span><span class="p">]</span>

    <span class="n">_map_to_ic_qualities_3</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">):</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># augmented triad</span>
        <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># major triad</span>
        <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># minor triad</span>
        <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">):</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">}</span>  <span class="c1"># diminished triad</span>

    <span class="n">_map_to_ic_qualities_4</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;+M&quot;</span><span class="p">):</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># aug major 7th</span>
        <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">):</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># minor major 7th</span>
        <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">):</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># major major 7th</span>
        <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">):</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># aug minor 7th</span>
        <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">):</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># half dim 7th</span>
        <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># minor minor 7th</span>
        <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># dominant 7th</span>
        <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">):</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">}</span>  <span class="c1"># fully dim 7th</span>

    <span class="n">_which_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="n">_map_to_ic_qualities_3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="n">_map_to_ic_qualities_4</span><span class="p">}</span>

<div class="viewcode-block" id="HarmonyQuality.smart_init"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.HarmonyQuality.smart_init">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">smart_init</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">n_chord_tones</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">upper</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">form_symbol</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;+M&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
        <span class="n">dict_to_check</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_which_dict</span><span class="p">[</span><span class="n">n_chord_tones</span><span class="p">]</span>
        <span class="n">ic_quality_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">IP</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dict_to_check</span><span class="p">[(</span><span class="n">upper</span><span class="p">,</span> <span class="n">form_symbol</span><span class="p">)]]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">stack_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">interval_class_quality_list</span><span class="o">=</span><span class="n">ic_quality_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div></div>


<div class="viewcode-block" id="FiguredBass"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.FiguredBass">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FiguredBass</span><span class="p">:</span>
    <span class="n">degrees</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Degree</span><span class="p">]</span>

    <span class="n">_figbass_degree_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;7&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="s2">&quot;65&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;43&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;42&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s2">&quot;64&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;6&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">}</span>  <span class="c1"># assume the first number x is: root + x = bass , 1 := unison</span>

<div class="viewcode-block" id="FiguredBass.parse"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.FiguredBass.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">figbass_str</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>  <span class="c1"># TODO: revise with alteration, add a dict to parse</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">regex_spm</span><span class="o">.</span><span class="n">fullmatch_in</span><span class="p">(</span><span class="n">figbass_str</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">HarmonyRegexes</span><span class="o">.</span><span class="n">figuredbass_regex</span><span class="p">:</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
                    <span class="n">degrees</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">Degree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">degree_str</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">FiguredBass</span><span class="o">.</span><span class="n">_figbass_degree_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">figbass_str</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>  <span class="c1"># otherwise, assume root position triad</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
                    <span class="n">degrees</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">Degree</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alteration</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                        <span class="n">Degree</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alteration</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                        <span class="n">Degree</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alteration</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div>

<div class="viewcode-block" id="FiguredBass.n_chord_tones"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.FiguredBass.n_chord_tones">[docs]</a>    <span class="k">def</span> <span class="nf">n_chord_tones</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AddedTones"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.AddedTones">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AddedTones</span><span class="p">:</span>
    <span class="n">degrees</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Degree</span><span class="p">]</span>

<div class="viewcode-block" id="AddedTones.parse"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.AddedTones.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">added_tones_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">regex_spm</span><span class="o">.</span><span class="n">match_in</span><span class="p">(</span><span class="n">added_tones_str</span><span class="p">)</span>

        <span class="k">match</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">HarmonyRegexes</span><span class="o">.</span><span class="n">added_tone_regex</span><span class="p">:</span>
                <span class="n">match_iter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span>
                    <span class="n">HarmonyRegexes</span><span class="o">.</span><span class="n">added_tone_regex</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">added_tones_str</span>
                <span class="p">)</span>
                <span class="n">degrees</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">Degree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">degree_str</span><span class="o">=</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">match_iter</span>
                <span class="p">]</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">degrees</span><span class="o">=</span><span class="n">degrees</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">instance</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="ReplacementTones"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.ReplacementTones">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ReplacementTones</span><span class="p">:</span>
    <span class="n">degrees</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Degree</span><span class="p">]</span>

    <span class="n">_regex_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([\^v][#b]*\d*)&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ReplacementTones.parse"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.ReplacementTones.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">replacement_tones_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        V7(9) , V7(b9) , V7(v#9), V7(^9) , V7(^b9) , V7(#9),</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">regex_spm</span><span class="o">.</span><span class="n">match_in</span><span class="p">(</span><span class="n">replacement_tones_str</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">case</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_regex_pattern</span><span class="p">:</span>
                <span class="n">match_iter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_regex_pattern</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">replacement_tones_str</span>
                <span class="p">)</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="n">replacement_tones</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Degree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">degree_str</span><span class="o">=</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">match_iter</span>
        <span class="p">]</span>  <span class="c1"># TODO: current version do not consider replaced from above or below (i.e., &#39;v&#39;, &#39;^&#39;)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">degrees</span><span class="o">=</span><span class="n">replacement_tones</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div></div>


<div class="viewcode-block" id="SingleNumeralParts"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeralParts">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">SingleNumeralParts</span><span class="p">:</span>
    <span class="n">roman_numeral</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">modifiers</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">form</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">figbass</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">added_tones</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">replacement_tones</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># the regular expression conforms with the DCML annotation standards</span>
    <span class="n">_sn_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;^(?P&lt;modifiers&gt;(b*)|(#*))&quot;</span>  <span class="c1"># accidentals</span>
        <span class="sa">r</span><span class="s2">&quot;(?P&lt;roman_numeral&gt;(VII|VI|V|IV|III|II|I|vii|vi|v|iv|iii|ii|i|Ger|It|Fr|@none))&quot;</span>  <span class="c1"># roman numeral</span>
        <span class="sa">r</span><span class="s2">&quot;(?P&lt;form&gt;(%|o|\+|M|\+M))?&quot;</span>  <span class="c1"># quality form</span>
        <span class="sa">r</span><span class="s2">&quot;(?P&lt;figbass&gt;(7|65|43|42|2|64|6))?&quot;</span>  <span class="c1"># figured bass</span>
        <span class="sa">r</span><span class="s2">&quot;(?P&lt;added_tones&gt;(\(\+[#b]*\d*)\))?&quot;</span>  <span class="c1"># added tones, non-chord tones added within parentheses preceded by a &quot;+&quot;</span>
        <span class="sa">r</span><span class="s2">&quot;(?P&lt;replacement_tones&gt;(\([\^v][#b]*\d*)\))?$&quot;</span>
    <span class="p">)</span>  <span class="c1"># replaced chord tones expressed through intervals &lt;= 8</span>

<div class="viewcode-block" id="SingleNumeralParts.parse"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeralParts.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">numeral_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
        <span class="c1"># match with regex</span>
        <span class="n">s_numeral_match</span> <span class="o">=</span> <span class="n">SingleNumeralParts</span><span class="o">.</span><span class="n">_sn_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">numeral_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s_numeral_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;could not match &#39;</span><span class="si">{</span><span class="n">numeral_str</span><span class="si">}</span><span class="s2">&#39; with regex: &#39;</span><span class="si">{</span><span class="n">SingleNumeralParts</span><span class="o">.</span><span class="n">_sn_regex</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>

        <span class="n">roman_numeral</span> <span class="o">=</span> <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;roman_numeral&quot;</span><span class="p">]</span>
        <span class="n">modifiers</span> <span class="o">=</span> <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;modifiers&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;modifiers&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">figbass</span> <span class="o">=</span> <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;figbass&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;figbass&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">added_tones</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;added_tones&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;added_tones&quot;</span><span class="p">]</span>
            <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">replacement_tones</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;replacement_tones&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s_numeral_match</span><span class="p">[</span><span class="s2">&quot;replacement_tones&quot;</span><span class="p">]</span>
            <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">modifiers</span><span class="o">=</span><span class="n">modifiers</span><span class="p">,</span>
            <span class="n">roman_numeral</span><span class="o">=</span><span class="n">roman_numeral</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span>
            <span class="n">figbass</span><span class="o">=</span><span class="n">figbass</span><span class="p">,</span>
            <span class="n">added_tones</span><span class="o">=</span><span class="n">added_tones</span><span class="p">,</span>
            <span class="n">replacement_tones</span><span class="o">=</span><span class="n">replacement_tones</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div></div>


<div class="viewcode-block" id="SnpParsable"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SnpParsable">[docs]</a><span class="k">class</span> <span class="nc">SnpParsable</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">Protocol</span><span class="p">):</span>
<div class="viewcode-block" id="SnpParsable.parse_snp"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SnpParsable.parse_snp">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">parse_snp</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">snp</span><span class="p">:</span> <span class="n">SingleNumeralParts</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="SingleNumeral"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeral">[docs]</a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SingleNumeral</span><span class="p">(</span><span class="n">ProtocolHarmony</span><span class="p">):</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">Key</span>
    <span class="n">degree</span><span class="p">:</span> <span class="n">Degree</span>
    <span class="n">quality</span><span class="p">:</span> <span class="n">HarmonyQuality</span>
    <span class="n">figbass</span><span class="p">:</span> <span class="n">FiguredBass</span>
    <span class="n">added_tones</span><span class="p">:</span> <span class="n">AddedTones</span>
    <span class="n">replacement_tones</span><span class="p">:</span> <span class="n">ReplacementTones</span>

<div class="viewcode-block" id="SingleNumeral.parse"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeral.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Key</span><span class="p">,</span> <span class="n">numeral_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
        <span class="n">snp</span> <span class="o">=</span> <span class="n">SingleNumeralParts</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">numeral_str</span><span class="o">=</span><span class="n">numeral_str</span><span class="p">)</span>

        <span class="c1"># parse key:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_str</span><span class="p">,</span> <span class="n">Key</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">Key</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">key_str</span><span class="o">=</span><span class="n">key_str</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key_str</span>

        <span class="c1"># parse degree:</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="n">Degree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">degree_str</span><span class="o">=</span><span class="n">snp</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">+</span> <span class="n">snp</span><span class="o">.</span><span class="n">roman_numeral</span><span class="p">)</span>

        <span class="c1"># parse added_tones: # TODO: double check the annotation tutorial (advanced section) for more complex cases</span>
        <span class="n">added_tones</span> <span class="o">=</span> <span class="n">AddedTones</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">added_tones_str</span><span class="o">=</span><span class="n">snp</span><span class="o">.</span><span class="n">added_tones</span><span class="p">)</span>

        <span class="c1"># replacement_tones: # TODO: double check the annotation tutorial (advanced section) for more complex cases</span>
        <span class="n">replacement_tones</span> <span class="o">=</span> <span class="n">ReplacementTones</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
            <span class="n">replacement_tones_str</span><span class="o">=</span><span class="n">snp</span><span class="o">.</span><span class="n">replacement_tones</span>
        <span class="p">)</span>

        <span class="c1"># parse figbass:</span>
        <span class="n">figbass</span> <span class="o">=</span> <span class="n">FiguredBass</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">figbass_str</span><span class="o">=</span><span class="n">snp</span><span class="o">.</span><span class="n">figbass</span><span class="p">)</span>

        <span class="c1"># parse quality, in stack of thirds:</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="n">HarmonyQuality</span><span class="o">.</span><span class="n">smart_init</span><span class="p">(</span>
            <span class="n">n_chord_tones</span><span class="o">=</span><span class="n">figbass</span><span class="o">.</span><span class="n">n_chord_tones</span><span class="p">(),</span>
            <span class="n">upper</span><span class="o">=</span><span class="n">snp</span><span class="o">.</span><span class="n">roman_numeral</span><span class="o">.</span><span class="n">isupper</span><span class="p">(),</span>
            <span class="n">form_symbol</span><span class="o">=</span><span class="n">snp</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># create class instance:</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
            <span class="n">degree</span><span class="o">=</span><span class="n">degree</span><span class="p">,</span>
            <span class="n">quality</span><span class="o">=</span><span class="n">quality</span><span class="p">,</span>
            <span class="n">figbass</span><span class="o">=</span><span class="n">figbass</span><span class="p">,</span>
            <span class="n">added_tones</span><span class="o">=</span><span class="n">added_tones</span><span class="p">,</span>
            <span class="n">replacement_tones</span><span class="o">=</span><span class="n">replacement_tones</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div>

<div class="viewcode-block" id="SingleNumeral.root"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeral.root">[docs]</a>    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpelledPitchClass</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">find_pc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">root</span></div>

<div class="viewcode-block" id="SingleNumeral.key_if_tonicized"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeral.key_if_tonicized">[docs]</a>    <span class="k">def</span> <span class="nf">key_if_tonicized</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Key</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make the current numeral as the tonic, return the spelled pitch class of the root as Key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">major_minor_key_mode</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;M&quot;</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="o">.</span><span class="n">interval_class_quality_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">IP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="o">.</span><span class="n">interval_class_quality_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">IP</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">else</span> <span class="s2">&quot;m&quot;</span>
        <span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">major_minor_key_mode</span><span class="p">)</span>  <span class="c1"># TODO: better version?</span>
        <span class="k">return</span> <span class="n">key</span></div>

<div class="viewcode-block" id="SingleNumeral.bass_degree"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeral.bass_degree">[docs]</a>    <span class="k">def</span> <span class="nf">bass_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Degree</span><span class="p">:</span>
        <span class="n">bass_degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figbass</span><span class="o">.</span><span class="n">degrees</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">bass_degree</span></div>

<div class="viewcode-block" id="SingleNumeral.bass_pc"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeral.bass_pc">[docs]</a>    <span class="k">def</span> <span class="nf">bass_pc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpelledPitchClass</span><span class="p">:</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">find_pc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bass_degree</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">pc</span></div>

<div class="viewcode-block" id="SingleNumeral.chord_tones"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeral.chord_tones">[docs]</a>    <span class="k">def</span> <span class="nf">chord_tones</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">SpelledPitchClass</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="SingleNumeral.pc_set"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.SingleNumeral.pc_set">[docs]</a>    <span class="k">def</span> <span class="nf">pc_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">SpelledPitchClass</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>


<div class="viewcode-block" id="Chain"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.Chain">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Chain</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">head</span><span class="p">:</span> <span class="n">T</span>
    <span class="n">tail</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Chain</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span></div>


<div class="viewcode-block" id="Numeral"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.Numeral">[docs]</a><span class="k">class</span> <span class="nc">Numeral</span><span class="p">(</span><span class="n">Chain</span><span class="p">[</span><span class="n">SingleNumeral</span><span class="p">]):</span>
<div class="viewcode-block" id="Numeral.parse"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.Numeral.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">numeral_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
        <span class="c1"># numeral_str examples: &quot;#ii/V&quot;, &quot;##III/bIV/V&quot;, &quot;bV&quot;, &quot;IV(+6)&quot;, &quot;vii%7/IV&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">numeral_str</span><span class="p">:</span>
            <span class="n">L_numeral_str</span><span class="p">,</span> <span class="n">R_numeral_str</span> <span class="o">=</span> <span class="n">numeral_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">R</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">key_str</span><span class="o">=</span><span class="n">key_str</span><span class="p">,</span> <span class="n">numeral_str</span><span class="o">=</span><span class="n">R_numeral_str</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">SingleNumeral</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                <span class="n">key_str</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">key_if_tonicized</span><span class="p">(),</span> <span class="n">numeral_str</span><span class="o">=</span><span class="n">L_numeral_str</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">SingleNumeral</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">key_str</span><span class="o">=</span><span class="n">key_str</span><span class="p">,</span> <span class="n">numeral_str</span><span class="o">=</span><span class="n">numeral_str</span><span class="p">)</span>
            <span class="n">R</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">head</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">tail</span><span class="o">=</span><span class="n">R</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div></div>


<div class="viewcode-block" id="TonalHarmony"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.TonalHarmony">[docs]</a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TonalHarmony</span><span class="p">(</span><span class="n">ProtocolHarmony</span><span class="p">):</span>
    <span class="n">globalkey</span><span class="p">:</span> <span class="n">Key</span>
    <span class="n">numeral</span><span class="p">:</span> <span class="n">Numeral</span>
    <span class="n">bookeeping</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>  <span class="c1"># for bookkeeping</span>

<div class="viewcode-block" id="TonalHarmony.parse"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.TonalHarmony.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">globalkey_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">localkey_numeral_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chord_str</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Self</span><span class="p">:</span>
        <span class="c1"># chord_str examples: &quot;IV(+6)&quot;, &quot;vii%7/IV&quot;, &quot;ii64&quot;</span>
        <span class="n">globalkey</span> <span class="o">=</span> <span class="n">Key</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">key_str</span><span class="o">=</span><span class="n">globalkey_str</span><span class="p">)</span>
        <span class="n">localkey</span> <span class="o">=</span> <span class="n">Numeral</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
            <span class="n">key_str</span><span class="o">=</span><span class="n">globalkey_str</span><span class="p">,</span> <span class="n">numeral_str</span><span class="o">=</span><span class="n">localkey_numeral_str</span>
        <span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">key_if_tonicized</span><span class="p">()</span>
        <span class="n">compound_numeral</span> <span class="o">=</span> <span class="n">Numeral</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
            <span class="n">key_str</span><span class="o">=</span><span class="n">localkey</span><span class="o">.</span><span class="n">to_str</span><span class="p">(),</span> <span class="n">numeral_str</span><span class="o">=</span><span class="n">chord_str</span>
        <span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">globalkey</span><span class="o">=</span><span class="n">globalkey</span><span class="p">,</span>
            <span class="n">numeral</span><span class="o">=</span><span class="n">compound_numeral</span><span class="p">,</span>
            <span class="n">bookeeping</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;globalkey_str&quot;</span><span class="p">:</span> <span class="n">globalkey_str</span><span class="p">,</span>
                <span class="s2">&quot;localkey_numeral_str&quot;</span><span class="p">:</span> <span class="n">localkey_numeral_str</span><span class="p">,</span>
                <span class="s2">&quot;chord_str&quot;</span><span class="p">:</span> <span class="n">chord_str</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div>

<div class="viewcode-block" id="TonalHarmony.pc_set"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.TonalHarmony.pc_set">[docs]</a>    <span class="k">def</span> <span class="nf">pc_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">SpelledPitchClass</span><span class="p">]:</span>
        <span class="n">pitchclass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chord_tones</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">added_tones</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pitchclass</span></div>

<div class="viewcode-block" id="TonalHarmony.root"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.TonalHarmony.root">[docs]</a>    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpelledPitchClass</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="TonalHarmony.key_if_tonicized"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.TonalHarmony.key_if_tonicized">[docs]</a>    <span class="k">def</span> <span class="nf">key_if_tonicized</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Key</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="TonalHarmony.to_numeral"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.TonalHarmony.to_numeral">[docs]</a>    <span class="k">def</span> <span class="nf">to_numeral</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Numeral</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="TonalHarmony.chord_tones"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.TonalHarmony.chord_tones">[docs]</a>    <span class="k">def</span> <span class="nf">chord_tones</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">SpelledPitchClass</span><span class="p">]:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="TonalHarmony.added_tones"><a class="viewcode-back" href="../../../api/dimcat.musana.html#dimcat.musana.harmony_types.TonalHarmony.added_tones">[docs]</a>    <span class="k">def</span> <span class="nf">added_tones</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">SpelledPitchClass</span><span class="p">]:</span>
        <span class="k">pass</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># result = Numeral.parse(key_str=&#39;C&#39;, numeral_str=&#39;V7(v#9)/IV/III&#39;)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">TonalHarmony</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
        <span class="n">globalkey_str</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">localkey_numeral_str</span><span class="o">=</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="n">chord_str</span><span class="o">=</span><span class="s2">&quot;V&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">root</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

          </div>

        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">dimcat</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../manual.html">Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/index.html">Example Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributions &amp; Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">Module Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Digital and Cognitive Musicology Lab @ École Polytechnique Fédérale de Lausanne.

      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>

    </div>




  </body>
</html>
